<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Informasi Objek Pajak Bidang Tanah</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        /* Dasar & Reset */
        body, html { 
            margin: 0; 
            padding: 0; 
            font-family: 'Inter', 'Segoe UI', 'Roboto', Arial, sans-serif; 
            height: 100%; 
            background: #f0f2f5; 
            overflow: hidden; 
        }
        
        /* Dashboard Awal dengan CSS Grid */
        #login-page {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            grid-template-rows: repeat(5, 1fr);
            gap: 8px;
            height: 100vh;
            background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
            padding: 20px;
            box-sizing: border-box;
            position: relative;
            overflow: hidden;
        }
        
        /* Animasi Background */
        #login-page::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: backgroundMove 20s linear infinite;
        }
        
        @keyframes backgroundMove {
            0% { transform: translate(0, 0); }
            100% { transform: translate(50px, 50px); }
        }

        /* Kotak Search (div1) - Posisi Tengah */
        .search-container {
            grid-column: 3;
            grid-row: 3;
            background: white;
            padding: 35px 30px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            color: #333;
            display: flex;
            flex-direction: column;
            justify-content: center;
            z-index: 2;
            min-width: 350px;
            align-self: center;
            animation: slideInUp 0.8s ease-out, floatAnimation 3s ease-in-out infinite;
            border: 2px solid rgba(255,255,255,0.1);
        }
        
        @keyframes slideInUp {
            from { 
                transform: translateY(50px); 
                opacity: 0; 
            }
            to { 
                transform: translateY(0); 
                opacity: 1; 
            }
        }
        
        @keyframes floatAnimation {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .search-container h2 {
            margin: 0 0 10px 0;
            color: #2c5364;
            text-align: center;
            font-size: 1.6rem;
            font-weight: 700;
            letter-spacing: -0.5px;
        }
        
        .search-container p {
            margin: 0 0 25px 0;
            text-align: center;
            color: #666;
            font-size: 0.9rem;
        }

        /* Kartu Informasi (div2) - Sebelah kanan Search */
        .card-sini-weh {
            grid-column: 4;
            grid-row: 3;
            background: white;
            border-radius: 20px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
            overflow: hidden;
            color: #333;
            display: flex;
            flex-direction: column;
            animation: slideInRight 0.8s ease-out 0.2s both;
            align-self: center;
            border: 2px solid rgba(255,255,255,0.1);
        }
        
        @keyframes slideInRight {
            from { 
                transform: translateX(50px); 
                opacity: 0; 
            }
            to { 
                transform: translateX(0); 
                opacity: 1; 
            }
        }

        .card-header-warning { 
            background: linear-gradient(135deg, #f39c12 0%, #f1c40f 100%);
            color: #000; 
            padding: 15px 20px; 
            font-weight: bold; 
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .card-body { 
            padding: 20px; 
            font-size: 0.9rem; 
            line-height: 1.6;
            background: #fff9e6;
        }

        /* Form Styling */
        input { 
            width: 100%; 
            padding: 15px 20px; 
            margin-bottom: 15px; 
            border: 2px solid #e0e0e0; 
            border-radius: 12px; 
            font-size: 1rem; 
            box-sizing: border-box;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }
        
        input:focus {
            outline: none;
            border-color: #2c5364;
            background: white;
            box-shadow: 0 0 0 4px rgba(44, 83, 100, 0.1);
            transform: translateY(-2px);
        }
        
        button.btn-akses { 
            width: 100%; 
            padding: 15px; 
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white; 
            border: none; 
            border-radius: 12px; 
            cursor: pointer; 
            font-weight: 600; 
            font-size: 1.05rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        button.btn-akses::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        button.btn-akses:hover::before {
            width: 300px;
            height: 300px;
        }
        
        button.btn-akses:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 25px rgba(40, 167, 69, 0.4);
        }
        
        button.btn-akses:active {
            transform: translateY(-1px);
        }

        /* UI MODAL ERROR */
        #errorModal {
            display: none; 
            position: fixed; 
            z-index: 9999; 
            left: 0; top: 0; width: 100%; height: 100%; 
            background-color: rgba(0,0,0,0.7);
            backdrop-filter: blur(8px);
            align-items: center; 
            justify-content: center;
        }
        
        .modal-content {
            background-color: white;
            border-radius: 20px;
            width: 90%;
            max-width: 550px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            animation: modalBounce 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            overflow: hidden;
        }
        
        .modal-header { 
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white; 
            padding: 25px; 
            font-size: 1.3rem; 
            font-weight: 700; 
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .modal-body { 
            padding: 30px; 
            color: #333; 
            font-size: 1rem; 
            line-height: 1.7;
            background: #fff;
        }
        
        .modal-body ul {
            margin: 15px 0;
            padding-left: 25px;
        }
        
        .modal-body li {
            margin-bottom: 10px;
            position: relative;
        }
        
        .modal-body li::marker {
            color: #e74c3c;
        }
        
        .modal-footer { 
            padding: 20px; 
            background: #f8f9fa; 
            text-align: center;
        }
        
        .btn-close-modal { 
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white; 
            border: none; 
            padding: 12px 40px; 
            border-radius: 10px; 
            cursor: pointer; 
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
        }
        
        .btn-close-modal:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(231, 76, 60, 0.4);
        }
        
        @keyframes modalBounce { 
            0% { 
                transform: scale(0.7) translateY(-50px); 
                opacity: 0; 
            } 
            50% { 
                transform: scale(1.05); 
            }
            100% { 
                transform: scale(1) translateY(0); 
                opacity: 1; 
            } 
        }

        /* Page 2: Map & Detail Card */
        #map-page { 
            display: none; 
            flex-direction: column; 
            height: 100vh; 
            width: 100%;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn { 
            from { opacity: 0; } 
            to { opacity: 1; } 
        }
        
        #map-container { 
            position: relative; 
            flex: 1; 
            min-height: 45vh;
        }
        
        #map { 
            height: 100%; 
            width: 100%; 
        }

        #detail-card { 
            background: linear-gradient(to bottom, #ffffff 0%, #f8f9fa 100%);
            padding: 30px; 
            box-shadow: 0 -10px 30px rgba(0,0,0,0.15); 
            overflow-y: auto; 
            display: grid; 
            gap: 25px; 
            grid-template-columns: 1fr; 
            height: 40vh;
            animation: slideUp 0.6s ease-out;
        }
        
        @keyframes slideUp {
            from {
                transform: translateY(100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @media (min-width: 768px) { 
            #detail-card { 
                grid-template-columns: 1fr 1fr; 
            } 
        }

        .info-group {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
        }
        
        .info-group:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.12);
        }
        
        .info-group h4 { 
            margin: 0 0 20px 0; 
            color: #2c5364;
            border-bottom: 3px solid #e0e0e0; 
            padding-bottom: 10px; 
            font-size: 1.2rem;
            font-weight: 700;
            letter-spacing: -0.3px;
        }
        
        /* PERBAIKAN JARAK DATA */
        .info-item { 
            margin-bottom: 12px; 
            font-size: 0.95rem; 
            display: flex; 
            align-items: flex-start;
            padding: 10px;
            border-radius: 8px;
            transition: all 0.2s ease;
        }
        
        .info-item:hover {
            background: #f8f9fa;
            transform: translateX(5px);
        }
        
        .info-item label { 
            font-weight: 600; 
            color: #555; 
            width: 130px; 
            flex-shrink: 0; 
            position: relative;
        }
        
        .info-item label::after { 
            content: ":"; 
            position: absolute; 
            right: 10px; 
        }
        
        .info-item span { 
            color: #2c3e50; 
            flex: 1;
            font-weight: 500;
        }

        .info-group-rekomendasi { 
            background: linear-gradient(135deg, #fff9e6 0%, #fff3cd 100%);
            padding: 20px; 
            border-radius: 15px; 
            border-left: 5px solid #f39c12;
            color: #856404;
            box-shadow: 0 4px 15px rgba(243, 156, 18, 0.1);
        }
        
        .info-group-rekomendasi h4 {
            color: #f39c12;
        }
        
        .back-btn { 
            position: absolute; 
            top: 15px; 
            left: 15px; 
            z-index: 1001; 
            padding: 12px 20px; 
            background: white;
            border-radius: 12px; 
            cursor: pointer; 
            font-weight: 600; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.2); 
            border: none;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            color: #2c5364;
        }
        
        .back-btn:hover {
            transform: translateX(-5px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.25);
            background: #2c5364;
            color: white;
        }

        @media (max-width: 1024px) {
            #login-page { 
                display: flex; 
                flex-direction: column; 
                justify-content: center; 
                align-items: center; 
            }
            .search-container, .card-sini-weh { 
                width: 100%; 
                max-width: 350px; 
                margin-bottom: 15px; 
            }
        }
    </style>
</head>
<body>

    <div id="login-page">
        <div class="search-container">
            <h2>üèòÔ∏è Sistem Informasi Objek Pajak Bidang Tanah</h2>
            <p>Cek status NIB dan NOP Anda</p>
            <input type="text" id="nibInput" placeholder="Masukkan Nomor NIB Anda..." autocomplete="off">
            <button class="btn-akses" onclick="verifikasiNIB()">
                <span style="position: relative; z-index: 1;">üîç Cek Detail & Peta</span>
            </button>
        </div>

        <div class="card-sini-weh">
            <div class="card-header-warning">
                <span style="font-size: 1.2rem;">‚ö†Ô∏è</span>
                <span>Informasi Penting</span>
            </div>
            <div class="card-body">
                Jika Anda merasa sudah lama tinggal di Soreang namun <b>tidak memiliki NIB</b>, kemungkinan bidang yang Anda tempati merupakan bagian dari <b>Tata Ruang Negara</b> yang tidak dapat diperjualbelikan.
            </div>
        </div>
    </div>

    <div id="errorModal">
        <div class="modal-content">
            <div class="modal-header">
                <span style="font-size: 1.5rem;">‚ö†Ô∏è</span>
                <span>Pemberitahuan</span>
            </div>
            <div class="modal-body" id="modalErrorMessage"></div>
            <div class="modal-footer">
                <button class="btn-close-modal" onclick="closeModal()">Tutup</button>
            </div>
        </div>
    </div>

    <div id="map-page">
        <div id="map-container">
            <button class="back-btn" onclick="kembaliKeInput()">
                <span>‚Üê</span>
                <span>Keluar</span>
            </button>
            <div id="map"></div>
        </div>
        
        <div id="detail-card">
            <div class="info-group">
                <h4>üìã Data Properti</h4>
                <div class="info-item"><label>NIB</label><span id="det-nib">-</span></div>
                <div class="info-item"><label>Tipe Hak</label><span id="det-tipe">-</span></div>
                <div class="info-item"><label>Luas</label><span><span id="det-luas">-</span> m¬≤</span></div>
                <div class="info-item"><label>NOP</label><span id="det-nop">-</span></div>
            </div>

            <div class="info-group info-group-rekomendasi">
                <h4>üí° Rekomendasi & Status</h4>
                <div id="det-rekomendasi" style="font-size: 0.95rem; line-height: 1.7; font-weight: 500;">
                    Memproses data...
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="data_tanah.js"></script>

    <script>
        var map;

        function verifikasiNIB() {
            var input = document.getElementById('nibInput').value.trim();
            if (!input) { showModalError("Silakan masukkan NIB terlebih dahulu!"); return; }

            var found = dataSoreang.features.find(f => f.properties.NIB && f.properties.NIB.toString() === input);

            if (found) {
                document.getElementById('login-page').style.display = "none";
                document.getElementById('map-page').style.display = "flex";
                isiInformasi(found.properties);
                initNavMap(found);
            } else {
                showModalError(`
                    <strong>Yahh NIB Anda belum terdaftar nihh ‚òπÔ∏è</strong><br><br>
                    Kemungkinannya:<br>
                    <ul style="margin-top:10px; padding-left:20px;">
                        <li>NIB belum terbit (ditunggu aja ya, nanti juga bakal terbit)</li>
                        <li>NIB merge atau penyatuan NIB dengan bidang bersebelahan. (jika bukan Anda yang melakukan merge NIB, lakukan pengecekan ke BPN karena kemungkinan ada penyerobotan oleh oknum pihak-pihak tidak bertanggungjawab.)</li>
                    </ul>
                `);
            }
        }

        function showModalError(message) {
            document.getElementById('modalErrorMessage').innerHTML = message;
            document.getElementById('errorModal').style.display = "flex";
        }

        function closeModal() { document.getElementById('errorModal').style.display = "none"; }

        window.onclick = function(event) {
            if (event.target == document.getElementById('errorModal')) { closeModal(); }
        }

        function isiInformasi(props) {
            document.getElementById('det-nib').innerText = props.NIB || "-";
            document.getElementById('det-tipe').innerText = props.TIPEHAK || "Kosong";
            document.getElementById('det-luas').innerText = props.LUASTERTUL || "0";
            document.getElementById('det-nop').innerText = props.NOP_1 || "-";

            var ket = props.KET ? props.KET.toLowerCase() : "";
            var rek = "";

            if (!props.KET || props.KET === "" || props.KET === "-") {
                rek = "NIB Anda terdaftar resmi dan NOP sesuai.\nANDA PRIBADI YANG TAAT ATURAN. SUATU KEBIASAAN BAIK YANG SUDAH DIMULAI, TETAP DILANJUTKAN YAA‚ù§Ô∏èüòá";
            } else if (ket.includes("1 nib beberapa nop")) {
                rek = "NIB Anda terdaftar resmi, namun NOP belum diperbaharui. Anda berpotensi \"Menanggung beban pajak yang bukan kewajiban anda\". Segera lapor ke Kantor BAPENDA untuk pembaruan NOP.\nTAPI KALO ANDA BAIK HATI, KAYA RAYA, RAJIN MENABUNG & TIDAK SOMBONG, SILAHKAN SAJA...GPPüôè";
            } else if (ket.includes("1 nop beberapa nib")) {
                rek = "NIB Anda terdaftar resmi, namun NOP belum diperbaharui. Anda berpotensi \"Menanggung beban pajak yang bukan kewajiban anda\", atau justru \"Anda membebani orang lain yang tidak berkewajiban membayar pajak anda\".\nJANGAN KIKIR..., NEGARA HANCUR KARNA ORANG SEPERTI ANDA. JANGAN IKUTI KEBIASAAN OKNUM PEJABAT KORUP YAAüò§";
            } else {
                rek = props.KET;
            }
            document.getElementById('det-rekomendasi').innerHTML = rek;
        }

        function initNavMap(targetFeature) {
            if (map) map.remove();
            map = L.map('map', { dragging: true, zoomControl: false, scrollWheelZoom: true, touchZoom: true });
            L.control.zoom({ position: 'topright' }).addTo(map);
            L.tileLayer('https://mt1.google.com/vt/lyrs=y&x={x}&y={y}&z={z}', { maxZoom: 20 }).addTo(map);
            var layer = L.geoJSON(targetFeature, { style: { color: "#00ff00", weight: 4, fillOpacity: 0.4 } }).addTo(map);
            map.fitBounds(layer.getBounds(), { padding: [50, 50] });
        }

        function kembaliKeInput() {
            document.getElementById('map-page').style.display = "none";
            document.getElementById('login-page').style.display = "grid";
        }
    </script>
</body>
</html>